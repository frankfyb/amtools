# 基于 Next.js 的英文文字转语音工具需求文档

## 一、需求背景与目标

### 1.1 需求背景

用户需要一款功能完整的英文文字转语音工具，实现 "英文文字输入 → 转换为音频" 的功能，核心诉求为：

- **免费服务优先**：基于谷歌免费 TTS 接口，无需付费 API 密钥；
- **跨域问题解决**：通过 Next.js 服务端 API 路由中转，规避浏览器跨域限制；
- **现代化技术栈**：基于 Next.js 14+ App Router + React 18+ + TypeScript 开发；
- **完整用户体验**：支持音频播放、下载、进度控制、语音参数配置等完整功能。

### 1.2 核心目标

| 目标类别 | 具体目标                                                                                                                                                  |
| -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 功能目标 | 1. 支持英文文本转换为 MP3 格式音频；2. 支持在线播放与本地下载；3. 支持语速、音调、音量等参数配置；4. 支持长文本智能分块处理。                                          |
| 技术目标 | 1. Next.js API 路由中转谷歌 TTS 请求；2. 双重音频生成机制（谷歌 TTS + 浏览器 Speech Synthesis）；3. 智能文本分块与音频合并；4. 响应时间 ≤ 4 秒（长文本）。 |
| 体验目标 | 1. 实时文本输入与状态反馈；2. 完整的音频播放控制（播放/暂停/进度/音量）；3. 多种语音选项与参数配置；4. 错误处理与用户提示。                                             |
| 约束目标 | 1. 符合谷歌免费服务条款；2. 支持最大 5000 字符文本；3. 无数据库依赖，轻量部署；4. 兼容现代浏览器。                           |

## 二、需求范围

### 2.1 功能范围（包含 / 不包含）

| 模块       | 包含功能                                                                                                                                                                                     | 不包含功能                                                                                           |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| 服务端模块 | 1. GET/POST 双接口支持；2. 智能文本分块处理（>300字符自动分块）；3. 音频流合并与返回；4. 错误处理与状态码管理；5. 请求缓存优化；6. 谷歌TTS API集成与代理。                                              | 1. 音频文件持久化存储；2. 用户认证与权限管理；3. 多语言支持（仅支持英文）；4. 高并发负载均衡。 |
| 客户端模块 | 1. 响应式文本输入区域（支持5000字符）；2. 实时语音参数配置（语速/音调/音量）；3. 完整音频播放器（播放/暂停/进度/下载）；4. 多种语音选项（6种英文语音）；5. 状态反馈与错误提示；6. 双重音频生成机制（谷歌TTS + Speech Synthesis API）。 | 1. 文本批量导入功能；2. 音频编辑功能（裁剪/合并）；3. 历史记录存储；4. 多音频格式支持（仅MP3）。  |
| 交互模块   | 1. 实时输入验证与字符计数；2. 双重音频生成机制；3. 智能文件命名；4. 防抖输入处理；5. 进度条与时间显示；6. 音频时长估算；7. 文件上传与文本导入；8. 实时语音参数调节。                                                                        | 1. 语音识别功能；2. 文本翻译功能；3. 音频可视化波形；4. 社交分享功能。                          |

### 2.2 技术范围

| 技术层面   | 选型要求                                                                                        | 说明                                                       |
| ---------- | ----------------------------------------------------------------------------------------------- | ---------------------------------------------------------- |
| 框架与语言 | 1. Next.js 14+ App Router；2. React 18+ with Hooks；3. TypeScript 完整类型支持；4. Tailwind CSS 样式。      | 现代化全栈架构，类型安全，响应式设计。 |
| 服务端依赖 | 1. Next.js 内置 fetch API；2. 智能文本分块算法；3. 音频流处理；4. 内存缓存机制。                 | 轻量级依赖，高性能音频处理。              |
| 客户端依赖 | 1. HTML5 Audio API；2. Speech Synthesis API；3. Blob URL 处理；4. 文件下载 API。 | 原生浏览器 API，无需额外库依赖。               |
| 部署环境   | 1. Node.js 18+ 运行时；2. Vercel/Netlify 等 Serverless 平台；3. 无数据库依赖。    | 轻量部署，自动扩缩容。                   |

#### 3.2.1 文本输入功能

- **输入框设计**：
  - 多行文本框，支持输入换行（转换时自动处理为空格）；
  - 实时字符计数，显示 "当前 {X}/5000 字符"，超过 5000 字符时高亮提示（红色文字）；
  - 输入校验：支持英文大小写字母、数字、标点符号（`.,!?;:()[]`）、空格等；
  - 清空功能：输入框右侧提供 "清空" 按钮，点击快速清空文本；
  - 文件导入：支持通过文件上传导入文本内容。

#### 3.2.2 参数配置功能

- **语速调节**：
  - 滑块组件，范围 0.1~3.0，步长 0.1，默认 1.0；
  - 滑块旁显示当前语速值（如 "1.0x"），拖动时实时更新；
  - 支持快速预设值选择（慢速0.5x、正常1.0x、快速2.0x）。

- **音调控制**：
  - 滑块组件，范围 0~2，步长 0.1，默认 1.0；
  - 实时调节音调高低，影响语音的音调特性。

- **音量控制**：
  - 滑块组件，范围 0~1，步长 0.1，默认 1.0；
  - 控制生成语音的音量大小。

- **语音类型选择**：
  - 下拉选择框，包含6种英文语音选项：
    - Google US English (Female) - 默认
    - Google UK English (Male)
    - Microsoft David (Male)
    - Microsoft Zira (Female)
    - Microsoft Mark (Male)
    - Microsoft Hazel (Female)
  - 选择后立即生效（下次转换时使用新语音类型）。

#### 3.2.3 音频转换与播放功能

- **转换流程**：

  1. 点击 "🔊生成语音" 按钮，触发以下逻辑：
     - 校验文本（非空、长度 ≤5000），校验失败提示错误；
     - 显示 "生成中..." 加载状态（按钮禁用，加载动画）；
     - 调用`/tools/english-text-voice/api/tts`接口，传递`text`、`speed`参数；
     - 支持长文本智能分块处理（>300字符自动分块并合并音频）；
  2. 转换成功：
     - 隐藏加载状态，启用音频播放器；
     - 音频流加载到`Audio`对象，准备播放；
     - 显示音频时长和播放控制界面；
  3. 转换失败：
     - 隐藏加载状态，恢复按钮可点击；
     - 显示错误提示（如 "文本过长""TTS服务暂时不可用"），提示文字为红色。

- **双重音频生成机制**：
  - 主要机制：通过谷歌TTS API生成高质量MP3音频文件；
  - 备用机制：使用浏览器Speech Synthesis API进行实时语音播放；
  - 智能切换：根据浏览器支持情况和服务可用性自动选择最佳方案。

- **音频播放控制**：
  - 播放器组件包含：播放/暂停按钮、进度条、时间显示、音量调节；
  - 播放状态：点击 "播放" 后按钮切换为 "暂停"，进度条随播放进度实时更新；
  - 进度控制：拖动进度条可跳转至指定播放位置；
  - 时间显示：显示当前播放时间和总时长（如 "01:23 / 03:45"）；
  - 音量控制：独立的音量滑块，范围 0~100%。

#### 3.2.4 音频下载功能

- **下载触发**：点击 "📥下载音频" 按钮，触发浏览器下载；
- **文件名规则**：`english-tts-{timestamp}.mp3`（如`english-tts-1640995200000.mp3`），确保文件名唯一；
- **音频格式**：MP3格式，兼容性好，文件大小适中；
- **兼容性**：支持主流浏览器（Chrome、Edge、Safari）的下载功能，使用Blob URL机制；
- **智能命名**：根据文本内容和时间戳生成有意义的文件名。

### 3.3 状态反馈模块（用户体验保障）

| 状态类型     | 触发场景                                                                      | 反馈方式                                                                                        |
| ------------ | ----------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| 输入校验反馈 | 1. 文本长度超出 5000 字符；2. 文本为空点击生成。            | 1. 输入框下方显示红色提示文字；2. 字符计数文字变红；3. 按钮点击后显示错误提示。   |
| 生成中反馈   | 点击 "🔊生成语音" 后，接口请求未完成前。                                      | 1. 按钮禁用，显示 "生成中..." 文字 + 旋转加载动画；2. 播放器区域显示加载状态。     |
| 生成成功反馈 | 接口返回 200 OK，音频流加载完成。                                             | 1. 加载动画消失，显示完整的音频播放器；2. 播放器显示音频时长和播放控制按钮；3. 启用下载功能。 |
| 生成失败反馈 | 1. 接口返回 400（参数错误）；2. 接口返回 500（服务端错误 / TTS服务不可用）。 | 1. 显示红色错误提示，包含具体错误信息；2. 按钮恢复可点击，允许重新尝试生成；3. 提供解决建议。                    |
| 播放状态反馈 | 音频播放、暂停、进度变化等操作。 | 1. 播放按钮状态实时切换；2. 进度条和时间显示实时更新；3. 音量变化即时反馈。 |

## 四、非功能需求

### 4.1 性能需求

| 需求项       | 具体要求                                                                                                       | 验收标准                                                                                                                    |
| ------------ | -------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| 接口响应时间 | 1. 客户端 → 服务端请求响应时间 ≤500ms；2. 服务端 → 谷歌接口 → 返回音频流时间 ≤1.5 秒（文本长度 ≤300 字符时）。 | 1. 网络正常（带宽 ≥10Mbps）时，点击转换后 ≤2 秒内音频就绪；2. 浏览器开发者工具 “网络” 面板显示接口总耗时 ≤2 秒。            |
| 音频加载速度 | 音频流加载完成时间 ≤1 秒（基于 128kbps 码率，30 秒音频约 500KB）。                                             | 点击播放后，无明显卡顿，进度条流畅更新，无 “缓冲中” 频繁出现（网络正常情况下）。                                            |
| 页面加载速度 | 客户端页面首次加载时间 ≤1.5 秒（资源加载完成，可交互）。                                                       | 1. 基于 Lighthouse 测试，页面加载性能得分 ≥80；2. 网络正常时，访问工具 URL 后 ≤1.5 秒显示完整界面（输入框、按钮、播放器）。 |

### 4.2 兼容性需求

| 需求项       | 具体要求                                                                                          | 验收标准                                                                                                                                                                             |
| ------------ | ------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 浏览器兼容性 | 支持以下浏览器最新版本：1. Chrome（≥120）；2. Edge（≥120）；3. Safari（≥16）；4. 飞书内嵌浏览器。 | 1. 在上述浏览器中，所有功能（输入、转换、播放、下载）正常使用；2. 界面无样式错乱（如按钮错位、文字溢出）；3. 音频播放无兼容性问题（如无声音、播放卡顿）。                            |
| 响应式适配   | 支持 PC 端（分辨率 ≥1366×768）、平板端（≥768×1024），界面布局自适应。                             | 1. PC 端：输入框 + 参数配置在左，播放器在右（左右分栏）；2. 平板端：输入框 + 参数配置在上，播放器在下（上下堆叠）；3. 所有设备上，关键按钮（转换、播放、下载）不被遮挡，可正常点击。 |

### 4.3 安全与合规需求

| 需求项   | 具体要求                                                                                                                        | 验收标准                                                                                                                                                      |
| -------- | ------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| 接口安全 | 1. 服务端 API 不暴露谷歌接口细节（如请求 URL、参数）；2. 客户端无法直接访问谷歌 TTS 接口，必须通过服务端中转。                  | 1. 浏览器开发者工具 “网络” 面板中，仅能看到`/api/google-tts`请求，无谷歌接口请求；2. 服务端代码中不泄露谷歌接口的核心参数（如`client=tw-ob`）。               |
| 合规性   | 1. 不违反谷歌免费翻译语音服务的使用条款（如非商业用途、不高频请求）；2. 工具界面明确提示 “仅用于非商业场景，遵守谷歌服务条款”。 | 1. 工具首页 / 帮助文档中添加合规提示文字；2. 不实现 “批量转换”“高频自动转换” 功能，避免触发谷歌反滥用机制。                                                   |
| 数据隐私 | 1. 不存储用户输入的文本；2. 不存储转换后的音频文件；3. 缓存仅在服务端内存临时存储（10 分钟失效）。                              | 1. 服务端无数据库 / 文件存储，重启后缓存清空；2. 客户端不通过`localStorage`/`sessionStorage`存储文本；3. 隐私提示：界面添加 “不存储您的输入文本与音频” 说明。 |

### 4.4 可用性需求

| 需求项       | 具体要求                                                                                                                 | 验收标准                                                                                                                                       |
| ------------ | ------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| 操作直观性   | 1. 核心流程（输入 → 转换 → 播放）步骤清晰，无多余操作；2. 按钮 / 组件名称易懂（如 “转换为音频” 而非 “提交”）。           | 1. 新用户无指导情况下，可在 30 秒内完成 “输入文本 → 转换 → 播放” 全流程；2. 组件标识明确，无歧义（如播放器进度条、音量滑块有清晰图标）。       |
| 错误可恢复性 | 1. 转换失败后，用户无需刷新页面，可直接修改文本 / 参数重新尝试；2. 错误提示包含 “如何解决” 建议（如 “文本过长请精简”）。 | 1. 转换失败后，输入框文本保留，参数不变，点击 “转换” 即可重新尝试；2. 错误提示文字包含解决方案（如 “请删除非英文字符后重试”）。                |
| 无障碍支持   | 1. 输入框、按钮支持键盘导航（Tab 键切换）；2. 关键元素（如播放按钮）有 ARIA 标签，支持屏幕阅读器。                       | 1. 仅使用键盘可完成所有操作（Tab 切换焦点，Enter 键触发按钮）；2. 屏幕阅读器（如 NVDA）可正确读取组件名称与状态（如 “播放按钮，未播放状态”）。 |

> （注：文档部分内容可能由 AI 生成）
