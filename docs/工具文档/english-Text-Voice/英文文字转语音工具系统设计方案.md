# 英文文字转语音工具系统设计方案

## 文档信息
- **项目名称**: 英文文字转语音工具 (English Text-to-Speech Tool)
- **版本**: v1.0
- **创建日期**: 2024年12月
- **更新日期**: 2024年12月
- **文档类型**: 系统设计方案

## 1. 系统架构设计

### 1.1 整体架构
本项目采用基于 Next.js 的全栈架构，集成前端界面和后端 API 服务：

```
┌─────────────────────────────────────────────────────────────┐
│                    用户界面层 (UI Layer)                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   文本输入组件   │  │   音频播放器     │  │   下载管理器     │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                   业务逻辑层 (Logic Layer)                    │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   状态管理       │  │   输入验证       │  │   错误处理       │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                    API 服务层 (API Layer)                    │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   TTS API路由    │  │   文本分块处理   │  │   音频合并       │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                   外部服务层 (External)                       │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │  Google TTS API │  │   音频处理       │  │   文件系统       │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 技术架构层次

#### 前端技术栈
- **框架**: Next.js 14 (App Router)
- **UI库**: React 18 + TypeScript
- **样式**: Tailwind CSS
- **状态管理**: React useReducer Hook
- **音频处理**: HTML5 Audio API
- **文件下载**: Blob API + URL.createObjectURL

#### 后端技术栈
- **运行时**: Node.js (Next.js API Routes)
- **HTTP客户端**: Axios
- **音频处理**: Buffer 操作
- **错误处理**: 自定义错误类型

#### 部署架构
- **平台**: Vercel
- **域名**: 自定义域名支持
- **CDN**: Vercel Edge Network
- **环境**: 生产环境 + 开发环境

## 2. 核心功能模块设计

### 2.1 客户端组件架构

```
src/app/tools/english-text-voice/
├── page.tsx                 # 主页面组件
├── components/
│   ├── TextInput.tsx       # 文本输入组件
│   ├── VoiceConfig.tsx     # 语音配置组件
│   ├── AudioPlayer.tsx     # 音频播放器组件
│   └── DownloadButton.tsx  # 下载按钮组件
├── hooks/
│   └── useTTS.ts          # TTS 自定义 Hook
├── types/
│   └── index.ts           # 类型定义
└── api/
    └── tts/
        └── route.ts       # TTS API 路由
```

### 2.2 详细模块设计

#### 2.2.1 文本输入模块 (TextInput)
**功能职责**:
- 提供多行文本输入界面
- 实时字符计数和验证
- 输入限制和错误提示

**核心接口**:
```typescript
interface TextInputProps {
  value: string;
  onChange: (text: string) => void;
  maxLength: number;
  placeholder?: string;
  disabled?: boolean;
}
```

**验证规则**:
- 最大字符数: 5000字符
- 最小字符数: 1字符
- 禁止纯空白字符

#### 2.2.2 语音配置模块 (VoiceConfig)
**功能职责**:
- 语音速度调节 (0.5x - 2.0x)
- 语言选择 (默认英语)
- 音质设置预览

**核心接口**:
```typescript
interface VoiceConfigProps {
  speed: number;
  onSpeedChange: (speed: number) => void;
  language: string;
  onLanguageChange: (lang: string) => void;
}
```

#### 2.2.3 音频生成模块 (AudioGeneration)
**功能职责**:
- 调用 Google TTS API
- 长文本分块处理
- 音频流合并
- 生成进度反馈

**核心流程**:
1. 文本预处理和分块 (每块约100字符)
2. 并发调用 TTS API
3. 音频数据合并
4. 返回完整音频 Buffer

#### 2.2.4 音频播放模块 (AudioPlayer)
**功能职责**:
- HTML5 Audio 播放控制
- 播放进度显示
- 音量控制
- 播放状态管理

**核心接口**:
```typescript
interface AudioPlayerProps {
  audioUrl: string | null;
  isPlaying: boolean;
  onPlay: () => void;
  onPause: () => void;
  onEnded: () => void;
}
```

#### 2.2.5 文件下载模块 (FileDownload)
**功能职责**:
- 音频文件下载
- 智能文件命名
- 浏览器兼容性处理

**命名规则**:
- 格式: `english-tts-{timestamp}.mp3`
- 时间戳: YYYYMMDD-HHMMSS
- 示例: `english-tts-20241201-143022.mp3`

### 2.3 API 路由设计

#### 2.3.1 TTS API 路由 (`/api/tts`)
**请求格式**:
```typescript
interface TTSRequest {
  text: string;      // 要转换的文本
  speed?: number;    // 语音速度 (0.5-2.0)
  language?: string; // 语言代码 (默认: en)
}
```

**响应格式**:
```typescript
interface TTSResponse {
  success: boolean;
  audioBuffer?: Buffer;  // 音频数据
  error?: string;        // 错误信息
  duration?: number;     // 音频时长
}
```

**处理流程**:
1. 请求参数验证
2. 文本长度检查和分块
3. Google TTS API 调用
4. 音频数据合并
5. 响应数据返回

## 3. 关键技术实现

### 3.1 状态管理
使用 React useReducer 实现集中式状态管理：

```typescript
interface AppState {
  text: string;
  isLoading: boolean;
  audioUrl: string | null;
  error: string | null;
  isPlaying: boolean;
  speed: number;
}

type AppAction = 
  | { type: 'SET_TEXT'; payload: string }
  | { type: 'SET_LOADING'; payload: boolean }
  | { type: 'SET_AUDIO_URL'; payload: string | null }
  | { type: 'SET_ERROR'; payload: string | null }
  | { type: 'SET_PLAYING'; payload: boolean }
  | { type: 'SET_SPEED'; payload: number };
```

### 3.2 性能优化

#### 3.2.1 文本分块处理
- 长文本自动分块 (每块约100字符)
- 并发 API 调用提高效率
- 智能断句避免单词截断

#### 3.2.2 音频缓存
- 客户端 Blob URL 缓存
- 避免重复生成相同内容
- 内存管理和清理

#### 3.2.3 用户体验优化
- 实时加载状态反馈
- 错误重试机制
- 响应式设计适配

### 3.3 错误处理

#### 3.3.1 输入验证错误
- 空文本提示
- 超长文本警告
- 特殊字符处理

#### 3.3.2 API 调用错误
- 网络连接失败
- TTS 服务不可用
- 请求超时处理

#### 3.3.3 音频处理错误
- 音频合并失败
- 播放器初始化错误
- 下载功能异常

## 4. 安全设计

### 4.1 输入验证
- 严格的文本长度限制
- XSS 攻击防护
- 恶意内容过滤

### 4.2 API 安全
- 请求频率限制
- 参数类型验证
- 错误信息脱敏

### 4.3 数据保护
- 不存储用户输入文本
- 临时音频文件自动清理
- 客户端数据加密传输

## 5. 部署和运维

### 5.1 Vercel 配置
```json
{
  "framework": "nextjs",
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "installCommand": "npm install",
  "devCommand": "npm run dev"
}
```

### 5.2 环境变量
```bash
# 生产环境
NEXT_PUBLIC_APP_URL=https://your-domain.com
NODE_ENV=production

# 开发环境
NEXT_PUBLIC_APP_URL=http://localhost:3000
NODE_ENV=development
```

### 5.3 监控和日志
- Vercel Analytics 集成
- 错误日志收集
- 性能指标监控
- 用户行为分析

## 6. 扩展性考虑

### 6.1 多语言支持
- 国际化 (i18n) 框架集成
- 多语言 TTS 引擎支持
- 本地化用户界面

### 6.2 音频格式扩展
- 支持多种音频格式 (WAV, OGG)
- 音质选择选项
- 压缩算法优化

### 6.3 批量处理功能
- 多文件批量转换
- 队列管理系统
- 进度跟踪界面

### 6.4 云服务集成
- AWS Polly 集成
- Azure Cognitive Services
- 自定义 TTS 模型支持

## 7. 总结

### 7.1 架构优势
- **简洁高效**: 基于 Next.js 的全栈架构，开发和部署简单
- **技术成熟**: 使用主流技术栈，社区支持完善
- **性能优化**: 分块处理和缓存机制提升用户体验
- **安全可靠**: 完善的输入验证和错误处理机制
- **易于部署**: Vercel 一键部署，自动 CI/CD

### 7.2 技术特色
- **跨域解决方案**: 通过服务端代理解决 Google TTS API 跨域问题
- **流式音频处理**: 分块生成和合并，支持长文本转换
- **智能缓存**: 客户端音频缓存，避免重复请求
- **响应式设计**: 适配桌面和移动设备
- **无障碍访问**: 符合 Web 无障碍标准

### 7.3 未来规划
- 集成更多 TTS 引擎选择
- 添加语音情感和语调控制
- 支持 SSML 标记语言
- 开发移动端应用
- 企业级功能扩展

---

**文档维护**: 本文档将随着项目发展持续更新，确保与实际实现保持同步。